# 多维表格附件预览插件 - 使用指南

## 快速开始

### 1. 安装依赖

在项目根目录下运行：

```bash
yarn install
```

### 2. 启动开发服务器

```bash
yarn start
```

服务器将在 http://localhost:3001 启动

### 3. 在多维表格中加载插件

1. 打开或新建一个飞书多维表格
2. 点击右侧的 **"插件"** 按钮展开插件面板
3. 点击 **"自定义插件"**
4. 点击 **"+新增插件"**
5. 在输入框中填入：`http://localhost:3001`
6. 点击 **"确定"**

![加载插件示意图](docs/load-plugin.png)

## 功能使用

### 📎 预览附件

#### 步骤 1: 准备附件数据
1. 在多维表格中创建或选择一个**附件类型**的字段
2. 在某个单元格中上传一些文件（图片、PDF、文档等）

#### 步骤 2: 选中单元格预览
1. 点击选中包含附件的单元格
2. 插件会自动加载并显示附件内容
3. 图片文件会直接显示预览图
4. 其他文件会显示文件信息（文件名、类型、大小）

#### 步骤 3: 切换多个附件
如果单元格中有多个附件：
- 点击底部的 **"← 上一个"** 按钮查看前一个附件
- 点击底部的 **"下一个 →"** 按钮查看后一个附件
- 顶部会显示当前位置，如 "2 / 5" 表示总共5个附件，当前查看第2个

### ✏️ 编辑图片

#### 步骤 1: 打开编辑器
1. 在预览图片时，图片右下角会显示 **"✏️ 编辑"** 按钮
2. 点击该按钮进入图片编辑模式

#### 步骤 2: 使用Excalidraw编辑
进入编辑器后，您可以：
- 在图片上添加文字标注
- 画箭头、线条、圆圈等形状
- 使用画笔自由绘制
- 添加便签和高亮
- 使用橡皮擦工具

#### 步骤 3: 返回预览
编辑完成后，点击顶部的 **"← 返回预览"** 按钮返回预览界面

## 界面说明

### 预览界面

```
┌─────────────────────────────────┐
│  附件预览              1 / 3     │  ← 头部：标题和计数器
├─────────────────────────────────┤
│                                  │
│     [图片预览区域]              │  ← 主内容区
│                                  │
│        [✏️ 编辑]                 │  ← 编辑按钮（仅图片时显示）
│                                  │
├─────────────────────────────────┤
│ 文件名: image.png               │
│ 文件类型: image/png             │  ← 文件信息
│ 文件大小: 125.5 KB              │
├─────────────────────────────────┤
│  [← 上一个]    [下一个 →]      │  ← 导航按钮（多个附件时显示）
└─────────────────────────────────┘
```

### 编辑界面

```
┌─────────────────────────────────┐
│ [← 返回预览]  图片编辑器        │  ← 头部：返回按钮和标题
├─────────────────────────────────┤
│                                  │
│                                  │
│    Excalidraw 画板              │  ← Excalidraw编辑器
│                                  │
│                                  │
└─────────────────────────────────┘
```

## 提示信息

插件会根据不同情况显示相应提示：

### 1. 未选中单元格
```
ℹ️
请选中附件字段的单元格
在多维表格中选择一个包含附件的单元格以预览文件
```

### 2. 选中非附件字段
```
ℹ️
请选中附件字段的单元格
在多维表格中选择一个包含附件的单元格以预览文件
```

### 3. 附件单元格为空
```
📎
当前单元格没有附件
```

### 4. 加载中
```
⏳
加载中...
```

### 5. 加载失败
```
⚠️
加载附件失败，请重试
[重试]
```

## 支持的文件类型

### 图片文件（可预览 + 可编辑）
- PNG (.png)
- JPEG (.jpg, .jpeg)
- GIF (.gif)
- WebP (.webp)
- SVG (.svg)
- BMP (.bmp)

### 文档文件（显示信息）
- PDF (.pdf)
- Word (.doc, .docx)
- Excel (.xls, .xlsx)
- PowerPoint (.ppt, .pptx)
- 文本文件 (.txt)

### 其他文件（显示信息）
- 压缩文件 (.zip, .rar)
- 音频文件 (.mp3, .wav)
- 视频文件 (.mp4, .avi)
- 等等...

## 常见问题

### Q: 为什么看不到附件预览？
**A:** 请确保：
1. 已选中多维表格中的单元格
2. 选中的是附件类型的字段
3. 单元格中有附件内容
4. 插件已正确加载

### Q: 图片加载很慢或加载失败？
**A:** 
- 附件URL有效期为10分钟
- 如果超时，重新点击单元格刷新
- 检查网络连接是否正常

### Q: 编辑按钮不显示？
**A:** 编辑按钮只在预览图片类型的附件时显示，其他文件类型不支持编辑功能

### Q: 可以保存编辑后的图片吗？
**A:** 当前版本的编辑器主要用于标注和临时编辑，暂不支持保存回多维表格

### Q: 支持深色模式吗？
**A:** 是的，插件会自动适配系统的深色模式设置

## 开发与部署

### 本地开发
```bash
# 启动开发服务器
yarn start

# 插件地址
http://localhost:3001
```

### 生产构建
```bash
# 构建
yarn build

# 预览构建结果
yarn preview
```

### 部署到生产环境

1. **使用Vercel部署**
   ```bash
   # 安装 Vercel CLI
   npm i -g vercel
   
   # 部署
   vercel --prod
   ```

2. **使用其他平台**
   - 构建产物在 `dist` 目录
   - 需要支持 HTTPS 协议
   - 确保 `vite.config.mts` 中设置了 `base: './'`

3. **在多维表格中使用**
   - 将部署后的 HTTPS 地址填入自定义插件输入框
   - 例如：`https://your-plugin.vercel.app`

## 技术支持

如有问题或建议，请联系开发团队。

## 更新日志

### v1.0.0 (2025-01-16)
- ✨ 初始版本发布
- 📎 支持附件预览功能
- 🖼️ 支持图片文件直接预览
- 📝 显示文件详细信息
- ⬅️➡️ 支持多附件切换
- ✏️ 集成Excalidraw图片编辑器
- 🌓 支持深色模式

